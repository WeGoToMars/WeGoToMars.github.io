<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SAT score calculator</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L37PYBSRKL"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-L37PYBSRKL');
        </script>
        <link rel="stylesheet" href="styles.css">
        <style>
            h1 {
                text-align: center
            }
            h4 {
                text-align: center
            }
        </style>
    </head>
    <body>
        <font size="+2"><h1>SAT score calculator</h1></font>
        <h3 style="text-align: center;">Based on past SAT curves (2016-2021)</h3>
        <div id='content' style="text-align: center;">
            <div class="omrs-input-group">
				<label class="omrs-input-underlined">
				  <input id="score0" name="score0" required>
				  <span class="omrs-input-label">Math Wrong answers number</span> <br><br>
            <canvas id="chart0"></canvas>
            <br>
            <font size="-1"><i>On PC, you also can press enter to update</i></font>
            <button class="btn" id='btn' style="width:160px;height:60px;" onclick="updateChart(chart0,labarr0,mathCurveDatabase, 'score0');updateChart(chart1,labarr1,readingCurveDatabase, 'score1');updateChart(chart2,labarr2,readingCurveDatabase, 'score2');calculateProbability(chart3)"><font size="+2">UPDATE ALL</font></button>
            <br>
            <div class="container">
                <div class="item">
                    <div class="omrs-input-group">
                        <label class="omrs-input-underlined">
                        <input id="score1" name="score1" required>
                        <span class="omrs-input-label">Reading Wrong answers number</span> <br>
                    <canvas id="chart1"></canvas>
                    </div>
                </div>
                <br>
                <div class="item">
                    <div class="omrs-input-group">
                        <label class="omrs-input-underlined">
                        <input id="score2" name="score2" required>
                        <span class="omrs-input-label">Writing Wrong answers number</span> <br>
                    <canvas id="chart2"></canvas>
                    </div>
                </div>
            </div>
            <div style="margin-top:320px;text-align: center;">
                <font size="+1"><h2>Final Score</h2></font>
                <h3>Enter all 3 fields to see final score</h3>
                <canvas id="chart3"></canvas>
            </div>
            <br>
            <p>Questions? Feedback? Contact me!</p>
            <ul class="share-buttons" data-source="simplesharingbuttons.com">
                <li><a href="https://www.reddit.com/message/compose/?to=WeGoToMars7" target="_blank" title="Message on Reddit" onclick="window.open('https://www.reddit.com/message/compose/?to=WeGoToMars7')"><img alt="Message on Reddit" src="images/flat_web_icon_set/color/Reddit.png" /></a></li>
              </ul>
            </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="database.js"></script>
        <script>
            dataarr0 = new Array(61)
            dataarr0.fill(0)  
            labarr0 = [] 
            Chart.defaults.plugins.legend.display = false
            var chart0 = new Chart(document.getElementById("chart0"), {
            type: 'bar',
            data: {
                labels: [700,710,720,730,740,750,760,770,780,790,800],
                datasets: [
                { 
                    data: dataarr0,
                    fill: true,
                    backgroundColor: 'rgb(255, 99, 132)'
                }
                ]
            }
            });

            dataarr1 = new Array(61)
            dataarr1.fill(0)  
            labarr1 = [] 
            var chart1 = new Chart(document.getElementById("chart1"), {
            type: 'bar',
            data: {
                labels: [300,310,320,330,340,350,360,370,380,390,400],
                datasets: [
                { 
                    data: dataarr1,
                    fill: true,
                    backgroundColor: 'rgb(36, 191, 67)'
                }
                ]
            }
            });

            dataarr2 = new Array(61)
            dataarr2.fill(0)  
            labarr2 = [] 
            var chart2 = new Chart(document.getElementById("chart2"), {
            type: 'bar',
            data: {
                labels: [300,310,320,330,340,350,360,370,380,390,400],
                datasets: [
                { 
                    data: dataarr2,
                    fill: true,
                    backgroundColor: 'rgb(22, 11, 179)'
                }
                ]
            }
            });
 
            labarr3 = [] 
            var chart3 = new Chart(document.getElementById("chart3"), {
            type: 'bar',
            data: {
                labels: [700,710,720,730,740,750,760,770,780,790,800],
                datasets: [
                { 
                    data: dataarr0,
                    fill: true,
                    backgroundColor: 'rgb(52, 235, 216)'
                }
                ]
            }
            });

            score0.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("btn").click();
            }
            });
            score1.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("btn").click();
            }
            });
            score2.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("btn").click();
            }
            });

            function updateChart(chart,labarr,database, score) { 
                window.score = score
                window.chart = chart
                window.database = database
                chart.data.datasets[0].data = new Array(61).fill(0)
                database.forEach(countPercentage)

                var indexOfMaxValue = chart.data.datasets[0].data.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);

                for (var i = 0; i <= 9; i++) {
                    labarr[i] = (indexOfMaxValue-5+i)*10+200;
                }
                chart.data.labels = labarr;
                
                chart.data.datasets[0].data = chart.data.datasets[0].data.slice(indexOfMaxValue-5,indexOfMaxValue+5)

                switch (score) {
                    case "score0":
                        window.chartdata0 = chart.data.datasets[0].data
                        window.chartlabels0 = chart.data.labels
                        break
                    case "score1":
                        window.chartdata1 = chart.data.datasets[0].data
                        window.chartlabels1 = chart.data.labels
                        break
                    case "score2":
                        window.chartdata2 = chart.data.datasets[0].data
                        window.chartlabels2 = chart.data.labels
                }
                                
                chart.update()
            };

            function countPercentage(item, index, arr) {
                var input = document.getElementById(window.score).value
                window.chart.data.datasets[0].data[(item[input]-200)/10] = chart.data.datasets[0].data[(item[input]-200)/10]+1 / window.database.length  * 100
            };

            function calculateProbability(chart) {
                res = new Array(121).fill(0)
                for (let a = 0; a < window.chartdata0.length; a++) {
                    for (let b = 0; b < window.chartdata1.length; b++) {
                        for (let c = 0; c < window.chartdata2.length; c++){
                            finalscore = window.chartlabels0[a] + window.chartlabels1[b] + window.chartlabels2[c]
                            prob = window.chartdata0[a] * window.chartdata1[b] * window.chartdata2[c] / 10000
                            res[(finalscore-400)/10] = res[(finalscore-400)/10] + prob
                        }
                    }
                }
                var indexOfMaxValue = res.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);

                for (var i = 0; i <= 9; i++) {
                    labarr3[i] = (indexOfMaxValue-5+i)*10+400;
                }
                chart.data.labels = labarr3;
                chart.data.datasets[0].data = res.slice(indexOfMaxValue-5,indexOfMaxValue+5)
                chart.update()
            }
        </script>
    </body>
</html>