<!DOCTYPE html>
<html lang = "en">
    <head>
        <title>ACT Score Calculator</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L37PYBSRKL"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-L37PYBSRKL');
        </script>
        <link rel="stylesheet" href="styles.css">
        <style>
            h1 {
                margin-top: 10px;
                text-align: center;
                margin-bottom: 15px;
                font-size: 4rem;
            }
            h2 {
                margin-bottom: 10px;
                font-size: 1.8rem;
            }
            h3 {
                font-size: 1.5rem;
            }
        </style>
        <link rel="icon" type="image/png" href="/images/favicon.png">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="With ACT Score Calculator, you can accurately predict your future scores using different curves from 2015 to 2021"/>
    </head>
    <body onload="curveDateData();curveSelector();getLastUpdate();buttonclick()">
        <h1>ACT score calculator</h1>
        <p id='themelabel' style="text-align: center;margin-bottom: 7px;">Enable theme</p>
        <div onclick="switchmode();buttonclick()" class="toggle-btn" id="toggle-btn">
            <input id='dark' type="checkbox">
            <span></span>
        </div>
        <div class='col'>
            <button type="button" class="collapsible"><a>Configure curves (advanced settings)</a></button>
            <div class="datadescription" style="text-align: center;">
                <div class='notes'>
                    <h3>Notes</h3>
                    <p>Unchecking the ACT curve will remove it from calculation</p>
                        <p>Test difficulty is displayed as a relative value in range from 0 to 1, where
                            0 is the easiest test (curve falls off quicker, you get more punished for mistakes) and
                            1 is the hardest one (curve falls of slower, you get less punished for mistakes).</p> 
                        <p>Click on a column header to sort the table</p>
                        <p>Test dates are colored <span class='fullcurvesdates'><b>blue</b></span> for full curves, <span class='redditcurvesdates'><b>red</b></span> for Reddit curves.</p>
                        <span><a class='bottomlink' onclick="showBottomCollapsible()">Click here</a> to learn more about types of curves the calculator uses.</span> <br> <br>
                </div>
                <button style="width:200px;height:25px;" class="btn" id='uncheckall'>UNCHECK ALL</button>
                <table class='js-sort-table' style="text-align: center; font-size: 14px; margin: 0 auto; margin-top: 10px;" id='curveselector'>
                    <thead>
                        <tr>
                            <th class="js-sort-date"><b>Test Date</b></th>
                            <th></th>
                            <th>English <br> Difficulty</th>
                            <th>Math <br> Difficulty</th>
                            <th>Reading <br> Difficulty</th>
                            <th>Science <br> Difficulty</th>
                            <th><b>Total <br> Difficulty</b></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table> <br>
            </div>
        </div>
        <div class='stats'>
            <span id='curvenumber'>Currently using .. different ACT test curves!</span> <br>
            <span id='lastupdate'>Last update was some time ago, trying to find when...</span> <br>
            <span>Get more info on project's <a target="_blank" href='https://github.com/WeGoToMars/WeGoToMars.github.io/tree/master/act_calculator'>GitHub page</a>.</span> <br>
        </div> <br>
        <div onclick="location.href='/sat_calculator/'" id='link'>
            <img style='height: 2.6rem;margin:2px;float:left;' src="/images/calc.png">
            <p style="text-align: center;">Click to switch to <b>SAT</b> Score Calculator</p>
        </div> <br>
        <div id='content' style="text-align: center;"> <br>
            <div class="input-group">
            <div class="vgroup">
                <div class="item">
                    <div class="input-group">
                        <label class="input-underlined">
                        <input type="number" pattern="[0-9]*" inputmode="numeric" id="scoree" name="scoree" required>
                        <span class="input-label">English Wrong answers number</span> <br>
                    <canvas id="charte"></canvas>
                    </div>
                </div>
                <div class="item">
                    <div class="input-group">
                        <label class="input-underlined">
                        <input type="number" pattern="[0-9]*" inputmode="numeric" id="scorem" name="scorem" required>
                        <span class="input-label">Math Wrong answers number</span> <br>
                    <canvas id="chartm"></canvas>
                    </div>
                </div>
            </div>
            <div class="vgroup" id='chartrow2'>
                <div class='item'>
                    <div class="input-group">
                        <label class="input-underlined">
                        <input type="number" pattern="[0-9]*" inputmode="numeric" id="scorer" name="scorer" required>
                        <span class="input-label">Reading Wrong answers number</span>
                    <canvas id="chartr"></canvas>
                    </div>
                </div>
                <div class='item'>
                    <div class="input-group">
                        <label class="input-underlined">
                        <input type="number" pattern="[0-9]*" inputmode="numeric" id="scores" name="scores" required>
                        <span class="input-label">Science Wrong answers number</span>
                    <canvas id="charts"></canvas>
                    </div>
                </div>
            </div>
            <div class="finalchart" style="text-align: center;">
                <h2>Your Predicted Composite Score</h2>
                <p>Enter the number of wrong answers in all 4 sections to see your predicted score</p>
                <canvas id="chart4"></canvas>
                <i class='pctooltip'>On PC, you also can press enter to update</i>
                <button class="btn" id='btn' style="width:200px;height:25px;" onclick="buttonclick()">UPDATE ALL</button>
            </div>
            <h3 id='median'>Your median score:</h3>
            <p id='persentile'>You are better than ...% of test takers!</p>
            <div class="input-group">
                <label class="input-underlined">
                <input style='border-bottom: none;padding-left: 0;left: 0;text-align: center' id="copylink" readonly="readonly" onclick="copyLink()">
                <span id='copylinkprompt' style="top: 0;width: 100%;left: 0" class="input-label">Click to copy direct link to this result</span> <br>
            <div class='col'>
            <button type="button" id='col1' class="collapsible">What curve data does the calculator use?</button>
            <div class="datadescription" style="text-align: left;">
            <h4>Currently, ACT calculator uses two types of curves:</h4>
            <p> <b>1) Full curves.</b> As of right now, I have curves from:
                <p id='fullcurvesdates'>array</p>
                <i>If you have another full curve - let me know!</i>
            </p><p>
                <b>2) Curves from <a href="https://www.reddit.com/r/ACT/">r/ACT</a>. </b>Those curves cover only the higher scores and will work only if you have a score of more than <b>30</b> in any section because of limited data. Reddit curves are applied automatically. As of right now, I have curves from:<br>
                <p id='redditcurvesdates'>array</p>
            </p>
            </div>
            </div>
            <p>Questions? Feedback? Contact me!</p>
            <ul class="share-buttons">
                <li><a href="https://www.reddit.com/message/compose/?to=WeGoToMars7" target="_blank" title="Message on Reddit" onclick="window.open('https://www.reddit.com/message/compose/?to=WeGoToMars7')"><img alt="Message on Reddit" src="/images/Reddit.png" /></a></li>
              </ul>
            </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
        <script src="database.js"></script>
        <script src="/sat_calculator/sort-table.js"></script>
        <script>
            window.onorientationchange = function() { 
            var orientation = window.orientation; 
            switch(orientation) { 
                case 0:
                case 90:
                case -90: window.location.reload(); 
                break; }
            }

            e = localStorage.getItem("scoree");
            m = localStorage.getItem("scorem");
            r = localStorage.getItem("scorer");
            s = localStorage.getItem("scores");

            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            ep = urlParams.get('e')
            mp = urlParams.get('m')
            rp = urlParams.get('r')
            sp = urlParams.get('s')

            if (ep !== null) {localStorage.setItem('scoree',ep)};
            if (mp !== null) {localStorage.setItem('scorem',mp)};
            if (rp !== null) {localStorage.setItem('scorer',rp)};
            if (sp !== null) {localStorage.setItem('scores',sp)};
            
            document.getElementById('scoree').value = localStorage.getItem('scoree');
            document.getElementById('scorem').value = localStorage.getItem('scorem');
            document.getElementById('scorer').value = localStorage.getItem('scorer');
            document.getElementById('scores').value = localStorage.getItem('scores');
            
            const getLastUpdate= async () => {
                response = await fetch('https://api.github.com/repos/WeGoToMars/WeGoToMars.github.io/commits?path=/act_calculator/');
                myJson = await response.json();
                var lastupdate = moment(myJson[0]['commit']['author']['date'])
                var now  = moment();
                var diffHuman = moment.duration(lastupdate.diff(now)).humanize();
                document.getElementById('lastupdate').innerHTML = 'Last update was '+diffHuman+' ago, on '+lastupdate.format('MMM Do YYYY, h:mm a');
                }

            function copyLink() {
                var promise = navigator.clipboard.writeText(document.getElementById('copylink').value);
                document.getElementById('copylinkprompt').innerHTML = '<b>Copied!</b>';
                setTimeout(() => {document.getElementById('copylinkprompt').innerHTML = 'Click to copy direct link to this result'},1500)
            }
            function showBottomCollapsible () {
                var body = document.body,
                html = document.documentElement;
                bottomCollapsible = document.getElementById('col1')
                var height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
                if (bottomCollapsible.className == 'collapsible') {
                    bottomCollapsible.click();
                }
                setTimeout(() => {  document.getElementById("col1").scrollIntoView();; }, 200);
            }

            userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (localStorage.getItem("theme")=='light') { userPrefersDark = false}
            if (localStorage.getItem("theme")=='dark') { userPrefersDark = true}

            if (userPrefersDark) {
                document.getElementById("dark").checked = true
                var IsOff = true;
                switchmode()
                document.getElementById("themelabel").innerHTML='Switch to light theme'
            } else {
                var IsOff = false;
                document.getElementById("themelabel").innerHTML='Switch to dark theme'
                switchmode()
                options={scales:{x:{grid:{color:"rgba(0,0,0,0.3)"},ticks:{color:"black"}},y:{grid:{color:"rgba(0,0,0,0.3)"},ticks:{color:"black"}}}};
            }

            function switchmode()
            {
                if(IsOff) //Turn on dark theme
                {
                    localStorage.setItem("theme", "dark");
                    document.documentElement.style.setProperty("--invert", "1");
                    document.documentElement.style.setProperty("--main-bg-color", "black");
                    document.documentElement.style.setProperty("--text-color", "white");
                    document.documentElement.style.setProperty("--button-color", "rgb(68,14,90)");
                    document.documentElement.style.setProperty("--button-focus-color", "rgb(47,9,62)");
                    document.documentElement.style.setProperty("--button-shadow-color", "rgb(68,14,90)");
                    document.getElementById("themelabel").innerHTML='Switch to light theme';
                    IsOff=false;
                    options={scales:{x:{grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"white"}},y:{grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"white"}}}};
                }
                else //Turn off dark theme
                {
                    localStorage.setItem("theme", "light");
                    document.documentElement.style.setProperty("--invert", "0");
                    document.documentElement.style.setProperty("--main-bg-color", "white");
                    document.documentElement.style.setProperty("--text-color", "black");
                    document.documentElement.style.setProperty("--button-color", "rgb(46, 204, 113)");
                    document.documentElement.style.setProperty("--button-focus-color", "rgb(39, 174, 96)");
                    document.documentElement.style.setProperty("--button-shadow-color", "rgba(0, 0, 0, 0.3)");
                    document.getElementById("themelabel").innerHTML='Switch to dark theme'
                    IsOff=true;
                    options={scales:{x:{grid:{color:"rgba(0,0,0,0.3)"},ticks:{color:"black"}},y:{grid:{color:"rgba(0,0,0,0.3)"},ticks:{color:"black"}}}};
                }
            }

            status0 = []
            dataarr0 = new Array(61)
            dataarr0.fill(0)  
            labarre = [] 
            Chart.defaults.plugins.legend.display = false
            var charte = new Chart(document.getElementById("charte"), {
            type: 'bar',
            data: {
                labels: [700,710,720,730,740,750,760,770,780,790,800],
                datasets: [
                { 
                    data: dataarr0,
                    fill: true,
                    backgroundColor: 'rgb(255, 99, 132)'
                }
                ]},
            options: options
            }
            );

            dataarr1 = new Array(61)
            dataarr1.fill(0)  
            labarrm = [] 
            var chartm = new Chart(document.getElementById("chartm"), {                                         //CHART 1
            type: 'bar',
            data: {
                labels: [300,310,320,330,340,350,360,370,380,390,400],
                datasets: [
                { 
                    data: dataarr1,
                    fill: true,
                    backgroundColor: 'rgb(36, 191, 67)'
                }
                ]},
            options: options
            }
            );

            dataarr2 = new Array(61)
            dataarr2.fill(0)  
            labarrr = [] 
            var chartr = new Chart(document.getElementById("chartr"), {                                         //CHART 2
            type: 'bar',
            data: {
                labels: [300,310,320,330,340,350,360,370,380,390,400],
                datasets: [
                { 
                    data: dataarr2,
                    fill: true,
                    backgroundColor: 'rgb(22, 11, 179)'
                }
                ]},
            options: options
            }
            );

            dataarr3 = new Array(61)
            dataarr3.fill(0)  
            labarrs = [] 
            var charts = new Chart(document.getElementById("charts"), {                                         //CHART 2
            type: 'bar',
            data: {
                labels: [300,310,320,330,340,350,360,370,380,390,400],
                datasets: [
                { 
                    data: dataarr3,
                    fill: true,
                    backgroundColor: 'rgb(163, 0, 217)'
                }
                ]},
            options: options
            }
            );
            
            dataarr4 = new Array(121).fill(0)
            labarr4 = [] 
            var chart4 = new Chart(document.getElementById("chart4"), {                                        //CHART 3
            type: 'bar',
            data: {
                labels: [700,710,720,730,740,750,760,770,780,790,800],
                datasets: [
                { 
                    data: dataarr4,
                    fill: true,
                    backgroundColor: 'rgb(52, 235, 216)'
                }
                ]},
            options: options
            }
            );

            function enterUpdateOnPC() {
                if (event.keyCode === 13) {
                event.preventDefault();
                buttonclick();
            }
            }

            scorer.addEventListener("keyup", enterUpdateOnPC);
            scoree.addEventListener("keyup", enterUpdateOnPC);
            scorem.addEventListener("keyup", enterUpdateOnPC);
            scores.addEventListener("keyup", enterUpdateOnPC);

            scorer.addEventListener('change', buttonclick);
            scoree.addEventListener('change', buttonclick);
            scorem.addEventListener('change', buttonclick);
            scores.addEventListener('change', buttonclick);

            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight){
                content.style.maxHeight = null;
                } else {
                content.style.maxHeight = content.scrollHeight + "px";
                }
            });
            }

            document.getElementById('uncheckall').onclick = function() {
                var checkboxes = document.querySelectorAll('input[type="checkbox"]');
                for (var i=1;i<checkboxes.length;i++) {
                    checkboxes[i].checked = false;
                }
            }

            function updateChart(chart,labarr,database, redditdatabase, score) { 
                window.score = score
                window.chart = chart
                window.database = database
                localdatabase = [...database]
                
                var checked=0;
                var checkboxes = document.querySelectorAll('input[type="checkbox"]');
                for (var i=1;i<checkboxes.length;i++) {
                    status0[i-1] = document.querySelector('.c'+(i-1)).checked
                    if (status0[i-1]){checked++}
                }
                document.getElementById('curvenumber').innerHTML = 'Currently using '+checked+' different ACT test curves!'

                var input = document.getElementById(window.score).value
                console.log(input)
                localStorage.setItem(score, input);
                if (input < 10 && input != '') {
                    localdatabase = localdatabase.concat(redditdatabase)
                } else {
                    localdatabase = localdatabase
                }

                for (var i=0;i<localdatabase.length;i++) {
                    if (!status0[i]) {
                        localdatabase[i] = [];
                    }
                    if (status0[i] && localdatabase[i]==[]) {
                        localdatabase[i] = database[i]
                    }
                }

                console.log(localdatabase)

                chart.data.datasets[0].data = new Array(100).fill(0)
                localdatabase.forEach(countPercentage)
                console.log(chart.data.datasets[0].data)

                var indexOfMaxValue = chart.data.datasets[0].data.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);
                
                if (input!='') {
                    for (var i = 0; i <= 9; i++) {
                        labarr[i] = (indexOfMaxValue-5+i);
                    }
                    chart.data.labels = labarr;
                };                
                
                chart.data.datasets[0].data = chart.data.datasets[0].data.slice(indexOfMaxValue-5,indexOfMaxValue+5)

                switch (score) {
                    case "scoree":
                        window.chartdata0 = chart.data.datasets[0].data
                        window.chartlabels0 = chart.data.labels
                        break
                    case "scorem":
                        window.chartdata1 = chart.data.datasets[0].data
                        window.chartlabels1 = chart.data.labels
                        break
                    case "scorer":
                        window.chartdata2 = chart.data.datasets[0].data
                        window.chartlabels2 = chart.data.labels
                    case "scores":
                        window.chartdata3 = chart.data.datasets[0].data
                        window.chartlabels3 = chart.data.labels
                }
                
                chart.options = options

                chart.update()
            };

            function countPercentage(item, index, arr) {
                var input = document.getElementById(window.score).value
                filtered = localdatabase.filter(function(val) {
                    return Object.keys(val).length !== 0;
                });
                window.chart.data.datasets[0].data[(item[input])] = chart.data.datasets[0].data[(item[input])]+1 / filtered.length * 100
            };

            function buttonclick() {
                updateChart(charte,labarrm,englishCurveDatabase, englishCurveReddit, 'scoree');
                updateChart(chartm,labarrr,mathCurveDatabase, mathCurveReddit,'scorem');
                updateChart(chartr,labarre,readingCurveDatabase, readingCurveReddit, 'scorer');
                updateChart(charts,labarrs,scienceCurveDatabase, scienceCurveReddit, 'scores');

                chart4.update();
                chart4.options = options;
                
                calculateProbability(chart4);
                calculateAverage(window.res);
                
                e = localStorage.getItem("scoree");
                m = localStorage.getItem("scorem");
                r = localStorage.getItem("scorer");
                s = localStorage.getItem("scores");

                document.getElementById('copylink').value = "wegotomars.github.io/act_calculator/?e="+e+'&m='+m+'&r='+r+'&s='+s;
            }

            function calculateProbability(chart) {
                res = new Array(36).fill(0)
                for (let a = 0; a < window.chartdata0.length; a++) {
                    for (let b = 0; b < window.chartdata1.length; b++) {
                        for (let c = 0; c < window.chartdata2.length; c++){
                            for (let d = 0; d < window.chartdata3.length; d++){
                                finalscore = Math.round((window.chartlabels0[a] + window.chartlabels1[b] + window.chartlabels2[c] + window.chartlabels3[d]) / 4)
                                prob = window.chartdata0[a] * window.chartdata1[b] * window.chartdata2[c] * window.chartdata3[d] / 1000000
                                res[(finalscore)] = res[(finalscore)] + prob
                            }
                        }
                    }
                }
                indexOfMaxValue = res.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);

                for (var i = 0; i <= 9; i++) {
                    labarr4[i] = (indexOfMaxValue-5+i);
                }
                chart.data.labels = labarr4;
                chart.data.datasets[0].data = res.slice(indexOfMaxValue-5,indexOfMaxValue+5)
                window.chartdata4 = chart.data.datasets[0].data
                window.chartlabels4 = chart.data.labels
                chart.update()
            };

            function calculateAverage(a) {
                a = a.filter(function(val) {
                    return val !== 0;
                });
                a = a.filter(function(val) {
                    return !Number.isNaN(val);
                });
                middle = a.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);
                
                medianscore = window.chartlabels4[window.chartdata4.indexOf(a[middle])]
                answer = "Your median final score: " + medianscore
                document.getElementById("median").innerHTML = answer

                persentile = percentiles[4][percentiles[4].length-medianscore]
                peranswer = "You are better than "+persentile+"% of test takers!"
                document.getElementById('persentile').innerHTML = peranswer
            }

            function curveDateData() {
                fullcurvesanswer = ''
                for (let i=0; i<window.curvesDatabaseEntries.length; i++){
                    fullcurvesanswer = fullcurvesanswer + curvesDatabaseEntries[i] + '<br>' 
                }
                document.getElementById("fullcurvesdates").innerHTML = fullcurvesanswer
                redditcurveanswer = ''
                for (let i=0; i<window.curvesDataReddit.length; i++){
                    redditcurveanswer = redditcurveanswer + curvesDataReddit[i] + '<br>' 
                }
                document.getElementById("redditcurvesdates").innerHTML = redditcurveanswer
            }

            function calculateDifficulty(database) {
                dif = []
                for (let i=0; i<database.length; i++) {
                    sum = 0
                    for (let j=0; j<7; j++) {
                        sum = sum + database[i][j]
                    }
                    dif.push(sum)
                }
                var indexOfMaxValue = dif.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);
                var minval = Math.min(...dif)
                diff = []
                for (let i=0; i<dif.length; i++) {
                    diff[i] = (dif[i]-minval) / (dif[indexOfMaxValue]-minval)
                }
                return diff
            }

            function curveSelector() {
                var table = document.getElementById("curveselector").getElementsByTagName('tbody')[0];

                var e=calculateDifficulty(englishCurveDatabase.concat(englishCurveReddit))
                var m=calculateDifficulty(mathCurveDatabase.concat(mathCurveReddit))
                var r=calculateDifficulty(readingCurveDatabase.concat(readingCurveReddit))
                var s=calculateDifficulty(scienceCurveDatabase.concat(scienceCurveReddit))
                dates=curvesDatabaseEntries.concat(curvesDataReddit)

                document.getElementById('curvenumber').innerHTML = 'Currently using '+window.dates.length+' different ACT test curves!'

                for (let i=0;i<window.dates.length;i++) {
                    var row = table.insertRow(i)
                    var celldate = row.insertCell(0)
                    if (i<curvesDatabaseEntries.length){
                        celldate.innerHTML = '<span class="fullcurvesdates"><b>'+window.dates[i]+'</b></span>';
                    } else {
                        celldate.innerHTML = '<span class="redditcurvesdates"><b>'+window.dates[i]+'</b></span>';
                    }
                    var cellbox = row.insertCell(1)
                    cellbox.innerHTML = '<input type="checkbox" class="c'+i+'" checked="true">'
                    var celle = row.insertCell(2)
                    celle.innerHTML = Math.round(e[i] *1000)/1000
                    var cellm= row.insertCell(3)
                    cellm.innerHTML = Math.round(m[i] *1000)/1000
                    var cellr = row.insertCell(4)
                    cellr.innerHTML = Math.round(r[i] *1000)/1000
                    var cells = row.insertCell(5)
                    cells.innerHTML = Math.round(s[i] *1000)/1000
                    var cellt = row.insertCell(6)
                    cellt.innerHTML = Math.round((e[i]+m[i]+r[i]+s[i])*1000/4) / 1000
                }

                sortTable(document.getElementById("curveselector"),0)
            }
        </script>
    </body>
</html>